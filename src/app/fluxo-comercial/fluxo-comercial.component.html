<div class="fluxo-page">
  <h2>Fluxo Comercial</h2>
  <h5>
    Ao atualizar, os negócios ganhos são salvos no banco e os pedidos são criados automaticamente na Bling.
  </h5>

  <div>
    <button mat-flat-button color="primary" (click)="atualizarDados()" [disabled]="loading">
      <span *ngIf="!loading">Atualizar</span>
      <span *ngIf="loading">Atualizando...</span>
    </button>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="40" strokeWidth="4" color="primary"></mat-spinner>
  </div>

  <div *ngIf="!loading" class="tabela-container">
    <div class="tabela-scroll">
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 sticky-header-table">

        <ng-container matColumnDef="person_name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Cliente</th>
          <td mat-cell *matCellDef="let deal">{{ deal.person_name }}</td>
        </ng-container>

        <ng-container matColumnDef="org_name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Empresa</th>
          <td mat-cell *matCellDef="let deal">{{ deal.org_name }}</td>
        </ng-container>

        <ng-container matColumnDef="formatted_value">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Valor</th>
          <td mat-cell *matCellDef="let deal">{{ deal.formatted_value }}</td>
        </ng-container>

        <ng-container matColumnDef="won_time">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Data</th>
          <td mat-cell *matCellDef="let deal">{{ deal.won_time | date: 'dd/MM/yyyy' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>

    <mat-paginator 
      [pageSizeOptions]="[5, 10, 25]"
      showFirstLastButtons
      [length]="dataSource.data.length"
      aria-label="Selecione a página">
    </mat-paginator>
  </div>
</div>